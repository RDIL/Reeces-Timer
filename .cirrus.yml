container:
  image: node:latest

test_task:
  always:
    yarn_cache:
      folder: node_modules
      fingerprint_script: |
        cat package.json
        cat yarn.lock
      populate_script: yarn
  test_script: yarn test

deploy_task:
  only_if: $CIRRUS_BRANCH == 'master'
  env:
    DEPLOY_TOKEN: ENCRYPTED[0ae86625c7337b4ba15d976173367299c357fc0a38fd9c6c22e7eb4248290e53dfc6abf22cc221b842c5089f929a0825]
  always:
    yarn_cache:
      folder: node_modules
      fingerprint_script: |
        cat package.json
        cat yarn.lock
      populate_script: yarn
  deploy_script: |
    yarn deploy-clean
    git remote set-url origin https://RDIL:${DEPLOY_TOKEN}@github.com/RDIL/Reeces-Timer.git
    git config user.name "Cirrus CI"
    git config user.email "support@rdil.rocks"
    yarn deploy
